{% extends "base/base.html" %}
{% load static %}

{% block title %}
    <title>{{product.name}} - "sitename"</title>
{% endblock %}

{% block addstylesheet %}
    <link rel="stylesheet" href="{% static 'product_detail.css' %}">
{% endblock %}

{% block content %}
    <div class="product-details">
        <div class="product-details__image">
            <img src="{{product_variant.image.url}}" alt="{{product.name}}" id="product-details__main-image">
        </div>
        <div class="product-details__info">
            <h3 class="product-details__name">{{product.name}}</h3>
            <div class="product-details__price">
                <span id="product-details__price-info">{{product_variant.price}} €</span>
            </div>
            <div class="product-details__options">
                <div class="product-details__option">
                    {% if product_variant.flavor %}
                    <div class="product-details__flavor">
                        <label for="flavor-select">Saveur</label>
                        <select class="form-select flavor-selector"id="flavor-select" name="flavor">
                            {% for flavor in flavors %}
                                <option value="{{ flavor }}" {% if flavor == product_variant.flavor %}selected{% endif %}>{{ flavor }}</option>
                            {% endfor %}
                        </select> 
                    </div>
                    {% endif %}
                    {% if product_variant.option %}
                    <div class="product-details__option-name">
                        <label for="option-select">{{option_name }}</label>
                    </div>
                    <div class="product-details__option-buttons">
                        {% for option in options %}
                            <button type="button" data-value="{{ option }}" class="btn {% if option == product_variant.option %}active{% endif %}">{{option }}</button>
                        {% endfor %}
                        <input type="hidden" id="selected-option" name="option" value="{{ product_variant.option }}">
                    </div>
                    {% endif %}
                </div>
            </div>
            <form method="POST" action="{% url 'shop:add_to_cart' slug=product.slug %}" class="product-details__form">
                {% csrf_token %}
                <div class="product-details__quantity">
                    <label for="quantity" style="visibility: hidden">Quantité:</label>
                    <div class="quantity-input-container">
                        <button id="decrement" type="button"> - </button>
                        <input type="number" name="quantity" value="1" min="1" class="input-number">
                        <button id="increment" type="button"> + </button>
                    </div>
                    <input type="hidden" name="variant_slug" value="{{product_variant.variant_slug}}" id="variant-slug-input">
                </div>
                <div class="product-details__add-to-cart">
                    <button type="submit" class="btn btn-primary">Ajouter au panier</button>
                </div>
            </form>
            <div class="product-details__review">
                <a href="{% url 'shop:add_review' slug=product.slug %}">Ajouter un commentaire</a>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        var csrfToken = "{{csrf_token}}";
        var default_selected_option = "{{product_variant.option}}";
        var get_variant_view_url = "{% url 'shop:get_product_variant_url' slug=product.slug %}"
        var update_variant_detail = "{% url 'shop:update_variant_detail' slug=product.slug %}"
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/product_detail.js' %}"></script>
{% endblock %}